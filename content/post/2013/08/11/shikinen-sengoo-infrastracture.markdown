---
layout: post
title: "式年遷宮Infrastracture"
published: true
date: "2013-08-11T15:19:00+09:00"
comments: true


---

[Immutable Infrastracture について / apatheia.info](http://apatheia.info/blog/2013/08/10/immutable-infrastructure/)  
こちらのエントリーを読んでふと思いついたので書きました。


[式年遷宮 / 伊勢神宮](http://www.isejingu.or.jp/shikinensengu/)  

今年、伊勢神宮は20年に一度の式年遷宮の年なのだが、  
このシステム、今のインターネットのインフラストラクチャの  
モデルとして結構参考になるのではないだろうか。  
  
さすがに20年間無停止で動いているサーバは  
その存在自体が重要文化財になってしまうが、例えば、１つのシステムを  
ロードバランサ、スイッチ、サーバ、ミドルウェア、ログ集約サーバなど  
完全に冗長化しておき、１週間毎に冗長化されたシステム、A、Bをそれぞれ入れ替える。  
  

このアーキテクチャを採用した場合、  
アプリケーションの大規模な改修が発生した場合にも  
スタンバイ側となっているインフラストラクチャ側で  
スナップショットのようなものを取得しておき、テストを行い、  
スナップショット時に戻れば、実サービスと同じ環境でテストが行える。  
  
アクティブ側となっているインフラストラクチャのハードに  
何かしらの問題が発生した場合、スタンバイ側のインフラストラクチャへ  
切り替えることにより、対障害性能を向上することが可能になる。  
  
また、アクティブスタンバイ化されたシステムは、なかなかどうして  
テスト時と同じ結果になってくれず、サービスダウンした際に  
フェイルオーバーしないことがよくある。  
  
しかし、この式年遷宮インフラストラクチャを採用すれば  
定期的に切り替えが発生するので、切り替え時にエラーが発生した場合にも  
発見が早くなり、結果的にシステムそのもののテストという側面を持ち、  
障害発生時に高確率でフェイルオーバーが成功するのではないだろうか。

問題となるのは、切り替えそのものの正確性の確保、一つのシステムを冗長化するコスト、  
切り替え前、切り替え前後の監視対象の切り替え、切り替え時のログの欠落をなくす工夫、  
切り替え時にサービスに影響を及ぼさない工夫など、実現する為には様々な困難はある。  
  
とはいえ、機械を利用し利便性を向上してきた我々は  
やはりその機械を運用するというそのものについても利便性を求め  
職人の技、秘伝のタレなど閉鎖的な情報に頼ること無く、また、運用担当者が  
毎日深い眠りに就けるよう、日々楽をする為の努力をしていきたいものであります。  

